resourceType: Questionnaire
title: Patient
extension:
  - url: >-
      http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-launchContext
    extension:
      - url: name
        valueCoding:
          code: Patient
      - url: type
        valueCode: Patient
  - url: https://emr-core.beda.software/StructureDefinition/questionnaire-mapper
    valueReference:
      reference: Mapping/patient
status: active
id: patient
url: patient
name: patient
meta:
  profile:
    - https://emr-core.beda.software/StructureDefinition/fhir-emr-questionnaire
item:
  - linkId: patient-id
    text: PatientId
    type: string
    readOnly: true
    hidden: true
    initialExpression:
      language: text/fhirpath
      expression: "%Patient.id"

  - linkId: patient-info-group
    text: 1. Name
    type: group
    item:
      - linkId: first-name
        code:
          - system: https://interrai.org/
            code: iA1a
        text: "a. First:"
        type: string
        required: true
        maxLength: 30
        entryFormat: "Enter first name"
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.name.given[0]"

      - linkId: middle-name
        code:
          - system: https://interrai.org/
            code: iA1b
        text: "b. Middle:"
        type: string
        required: false
        maxLength: 30
        entryFormat: "Enter middle name"
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.name.given[1]"

      - linkId: last-name
        code:
          - system: https://interrai.org/
            code: iA1c
        text: "c. Last:"
        type: string
        required: true
        entryFormat: "Enter last name"
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.name.family.first()"

      - linkId: title
        code:
          - system: https://interrai.org/
            code: iA1d
        text: "d. Title:"
        type: string
        required: false
        maxLength: 10
        entryFormat: "Jr./Sr."
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.name.prefix.first()"

  - linkId: sex-group
    code:
      - system: https://interrai.org/
        code: iA2
    text: 2. Sex / Gender identity
    type: group
    item:
      - linkId: sex
        code:
          - system: https://interrai.org/
            code: iA2c
        text: "a. Sex:"
        type: choice
        required: true
        initialExpression:
          language: text/fhirpath
          expression: |-
            %Questionnaire.repeat(item).where(linkId='sex').answerOption.valueCoding.where(
              code=iif(%Patient.gender='male' or %Patient.gender='female', %Patient.gender, 'other')
            )
        answerOption:
          - valueCoding:
              code: "male"
              system: http://hl7.org/fhir/administrative-gender
              display: Male
          - valueCoding:
              code: "female"
              system: http://hl7.org/fhir/administrative-gender
              display: Female
          - valueCoding:
              code: "other"
              system: http://hl7.org/fhir/administrative-gender
              display: Not assigned male or female

      - linkId: gender-identity
        text: "b. Gender Idenity:"
        type: choice
        itemControl:
          coding:
            - code: inline-choice
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.extension('http://hl7.org/fhir/StructureDefinition/individual-genderIdentity').extension('value').valueCodeableConcept.coding.first()"
        answerOption:
          - valueCoding:
              code: '446151000124109'
              system: http://snomed.info/sct
              display: Male
          - valueCoding:
              code: '446141000124107'
              system: http://snomed.info/sct
              display: Female
          - valueCoding:
              code: '33791000087105'
              system: http://snomed.info/sct
              display: Other gender identity
          - valueCoding:
              code: 'UNK'
              system: http://terminology.hl7.org/CodeSystem/v3-NullFlavor
              display: Not known
          - valueCoding:
              code: 'asked-declined'
              system: http://terminology.hl7.org/CodeSystem/data-absent-reason
              display: Not applicable

      - linkId: self-identified-gender
        text: "c. Person self-idenifies gender as:"
        type: string
        maxLength: 15
        entryFormat: "Enter up to 15 characters"
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.extension('http://hl7.org/fhir/StructureDefinition/individual-genderIdentity').extension('comment').valueString"
        enableWhen:
          - question: gender-identity
            operator: "="
            answerCoding:
              code: "33791000087105"
              system: http://snomed.info/sct
              display: Other gender identity

  - linkId: birthdate-group
    text: 3. Birthdate
    type: group
    item:
      - linkId: birthdate
        type: date
        required: true
        entryFormat: "Select birthdate"
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.birthDate"
  
  - linkId: marital-status-group
    text: 4. Marital status
    type: group
    item:
      - linkId: marital-status
        type: choice
        entryFormat: "Select marital status"
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.maritalStatus.coding.first()"
        answerOption:
          - valueCoding:
              code: 'S'
              system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
              display: 1. Never married
          - valueCoding:
              code: 'M'
              system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
              display: 2. Married
          - valueCoding:
              code: 'T'
              system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
              display: 3. Domestic partner
          - valueCoding:
              code: 'W'
              system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
              display: 4. Widowed
          - valueCoding:
              code: 'L'
              system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
              display: 5. Legally separated
          - valueCoding:
              code: 'D'
              system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
              display: 6. Divorced

  - linkId: ethnicity-race-group
    code:
      - system: https://interrai.org/
        code: iB3  
    text: 5. Ethnicity and race
    type: group
    item:
      - linkId: country-of-birth
        code:
        - system: https://interrai.org/
          code: iA45     
        text: "a. Country of birth:"
        type: string
        entryFormat: "Specify"
        initialExpression:
          language: text/fhirpath
          expression: "%Patient.extension('http://hl7.org/fhir/StructureDefinition/patient-birthPlace').valueAddress.text"        
      
      - linkId: indigenous-status
        code:
          - system: https://interrai.org/
            code: iB3k      
        text: "b. Indigenous status:"
        helpText: Is the client of Aboriginal or Torres Strait Islander origin?
        type: choice
        itemControl:
          coding:
            - code: inline-choice
        initialExpression:
              language: text/fhirpath
              expression: "%Patient.extension('http://hl7.org.au/fhir/StructureDefinition/indigenous-status').valueCoding"
        answerOption:
          - valueCoding:
              code: '1'
              system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
              display: 1. Yes, Aboriginal
          - valueCoding:
              code: '2'
              system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
              display: 2. Yes, Torres Strait Islander
          - valueCoding:
              code: '3'
              system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
              display: 3. Yes, both
          - valueCoding:
              code: '4'
              system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
              display: 4. No, neither

  - linkId: medicare-number-group
    text: 6. Medicare number
    type: group
    item:
      - linkId: medicare-number
        type: string
        required: true       
        initialExpression:
          language: text/fhirpath
          expression: |-
            %Patient.identifier.where(system='http://ns.electronichealth.net.au/id/medicare-number').value
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            valueString: 0000-0000-0

  - linkId: patient-record-number-group
    text: 7. Patient record or UR Number
    type: group
    item:
      - linkId: patient-record-number
        type: string
        required: true        
        initialExpression:
          language: text/fhirpath
          expression: |-
            %Patient.identifier.where(system='http://www.acme.com/identifiers/patient').value
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            valueString: e.g. UR12345678
