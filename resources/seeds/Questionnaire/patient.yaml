meta:
  profile:
    - https://emr-core.beda.software/StructureDefinition/fhir-emr-questionnaire
name: patient
item:
  - linkId: patient-id
    text: PatientId
    type: string
    readOnly: true
    extension:
      - url: http://hl7.org/fhir/StructureDefinition/questionnaire-hidden
        valueBoolean: true
      - url: >-
          http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
        valueExpression:
          language: text/fhirpath
          expression: "%Patient.id"

  - linkId: iA1
    text: 1. Name
    type: group
    item:
      - linkId: iA1a
        text: "a. First:"
        type: string
        required: true
        maxLength: 30
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            value:
              string: "Enter first name"
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.name.given[0]"

      - linkId: iA1b
        text: "b. Middle:"
        type: string
        required: false
        maxLength: 30
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            value:
              string: "Enter middle name"
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.name.given[1]"

      - linkId: iA1c
        text: "c. Last:"
        type: string
        required: true
        extension:
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.name.family.first()"

      - linkId: iA1d
        text: "d. Title:"
        type: string
        required: false
        maxLength: 10
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            value:
              string: "Jr./Sr."
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.name.prefix.first()"

  - linkId: iA2
    text: 2. Sex / Gender identity
    type: group
    item:
      - linkId: iA2c
        text: "a. Sex:"
        type: choice
        required: true
        extension:
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: |-
                %Questionnaire.repeat(item).where(linkId='gender').answerOption.valueCoding.where(
                  code=iif(%Patient.gender='male' or %Patient.gender='female', %Patient.gender, 'other')
                )
        answerOption:
          - value:
              Coding:
                code: "male"
                system: http://hl7.org/fhir/administrative-gender
                display: Male
          - value:
              Coding:
                code: "female"
                system: http://hl7.org/fhir/administrative-gender
                display: Female
          - value:
              Coding:
                code: "other"
                system: http://hl7.org/fhir/administrative-gender
                display: Not assigned male or female

      - linkId: iA2d
        text: "b. Gender Idenity:"
        type: choice
        itemControl:
          coding:
            - code: inline-choice
        extension:
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.extension('http://hl7.org/fhir/StructureDefinition/individual-genderIdentity').extension('value').valueCodeableConcept.coding.first()"
        answerOption:
          - value:
              Coding:
                code: '446151000124109'
                system: http://snomed.info/sct
                display: Male
          - value:
              Coding:
                code: '446141000124107'
                system: http://snomed.info/sct
                display: Female
          - value:
              Coding:
                code: '33791000087105'
                system: http://snomed.info/sct
                display: Other gender identity
          - value:
              Coding:
                code: 'UNK'
                system: http://terminology.hl7.org/CodeSystem/v3-NullFlavor
                display: Not known
          - value:
              Coding:
                code: 'asked-declined'
                system: http://terminology.hl7.org/CodeSystem/data-absent-reason
                display: Not applicable

      - linkId: iA2e
        text: "c. Person self-idenifies gender as:"
        type: string
        maxLength: 15
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            value:
              string: "Enter up to 15 characters"
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.extension('http://hl7.org/fhir/StructureDefinition/individual-genderIdentity').extension('value').valueCodeableConcept.text"
        enableWhen:
          - question: iA2d
            operator: "="
            answer:
              Coding:
                code: "33791000087105"
                system: http://snomed.info/sct
                display: Other gender identity


  - linkId: iA3-group
    text: 3. Birthdate
    type: group
    item:
      - linkId: iA3
        type: date
        required: true
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            value:
              string: "Select birthdate"
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.birthDate"
  
  - linkId: iA4-group
    text: 4. Marital status
    type: group
    item:
      - linkId: iA4
        type: choice
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            value:
              string: "Select marital status"
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.maritalStatus.coding.first()"
        answerOption:
          - value:
              Coding:
                code: 'S'
                system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
                display: 1. Never married
          - value:
              Coding:
                code: 'M'
                system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
                display: 2. Married
          - value:
              Coding:
                code: 'T'
                system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
                display: 3. Domestic partner
          - value:
              Coding:
                code: 'W'
                system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
                display: 4. Widowed
          - value:
              Coding:
                code: 'L'
                system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
                display: 5. Legally separated
          - value:
              Coding:
                code: 'D'
                system: http://terminology.hl7.org/CodeSystem/v3-MaritalStatus
                display: 6. Divorced

  - linkId: iB3
    text: 5. Ethnicity and race
    type: group
    item:
      - linkId: iA45
        text: "a. Country of birth:"
        type: string
        extension:
          - url: http://hl7.org/fhir/StructureDefinition/entryFormat
            value:
              string: "Specify"
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.extension('http://hl7.org/fhir/StructureDefinition/patient-birthPlace').valueAddress.text"        
      
      - linkId: iB3k
        text: "b. Indigenous status:"
        helpText: Is the client of Aboriginal or Torres Strait Islander origin? # TOFO: Add new view for this question
        type: choice
        itemControl:
          coding:
            - code: inline-choice
        extension:
          - url: >-
              http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression
            valueExpression:
              language: text/fhirpath
              expression: "%Patient.extension('http://hl7.org.au/fhir/StructureDefinition/indigenous-status').valueCoding"
        answerOption:
          - value:
              Coding:
                code: '1'
                system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
                display: 1. Yes, Aboriginal
          - value:
              Coding:
                code: '2'
                system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
                display: 2. Yes, Torres Strait Islander
          - value:
              Coding:
                code: '3'
                system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
                display: 3. Yes, both
          - value:
              Coding:
                code: '4'
                system: https://healthterminologies.gov.au/fhir/CodeSystem/australian-indigenous-status-1
                display: 4. No, neither

resourceType: Questionnaire
title: Patient
extension:
  - url: >-
      http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-launchContext
    extension:
      - url: name
        valueCoding:
          code: Patient
      - url: type
        valueCode: Patient
  - url: https://emr-core.beda.software/StructureDefinition/questionnaire-mapper
    valueReference:
      reference: Mapping/patient
status: active
id: patient
url: patient